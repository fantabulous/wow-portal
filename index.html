<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mondelez Partner Portal | Enquiry Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a professional feel */
        body { font-family: 'Inter', sans-serif; }
        .sidebar { 
            transition: width 0.3s ease; 
            flex-shrink: 0; 
        }
        
        /* Vertical Navigation Link Styling (Menu Items) */
        .nav-link-item { 
            @apply flex items-center justify-start p-3 text-sm font-medium rounded-lg transition-all duration-200 text-white/80 hover:bg-mondelez-yellow hover:text-mondelez-blue;
        }
        
        /* Dropdown Sub-Link Styling (Internal Menu Links) */
        .nav-link-sub {
            @apply block px-4 py-2 text-sm font-medium text-white/80 hover:bg-mondelez-blue/70 hover:text-white whitespace-nowrap;
        }
        .nav-text {
            white-space: nowrap;
            overflow: hidden;
            transition: width 0.3s ease, opacity 0.3s ease;
        }

        /* Active Link Styling (Solid block of accent color) */
        .active-link { 
            @apply bg-mondelez-yellow text-mondelez-blue font-bold shadow-md hover:bg-mondelez-yellow hover:text-mondelez-blue;
        }

        .active-link-sub {
            @apply bg-mondelez-yellow text-mondelez-blue font-bold shadow-md hover:bg-mondelez-yellow hover:text-mondelez-blue;
        }

        /* Ensure main content takes up remaining vertical space */
        .page-content { 
            min-height: calc(100vh - 4rem); 
        }
        .chat-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; 
        }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        /* Custom scrollbar for aesthetics */
        .chat-messages::-webkit-scrollbar { width: 8px; }
        .chat-messages::-webkit-scrollbar-thumb { background-color: #4f2170; border-radius: 4px; }
        .chat-messages::-webkit-scrollbar-track { background-color: #e5e7eb; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mondelez-blue': '#4f2170', /* Primary Deep Purple */
                        'mondelez-yellow': '#ffd700', /* Primary Gold/Accent Yellow */
                    }
                }
            }
        }
    </script>
    <!-- Icon Library (Lucide) -->
    <script type="module">
        import { createIcons, Search, LayoutDashboard, Briefcase, Users, BookOpen, Award, Globe, ClipboardList, Phone, FileText, Bot, ChevronsLeft, GraduationCap, Calendar, MessageSquare, Download, ChevronDown, User, Send, ListOrdered, FileSearch, HelpCircle, UserCheck } from 'https://cdn.jsdelivr.net/npm/lucide@latest/dist/esm/lucide.js';
        createIcons({ icons: { Search, LayoutDashboard, Briefcase, Users, BookOpen, Award, Globe, ClipboardList, Phone, FileText, Bot, ChevronsLeft, GraduationCap, Calendar, MessageSquare, Download, ChevronDown, User, Send, ListOrdered, FileSearch, HelpCircle, UserCheck } });
    </script>
</head>

<body class="bg-gray-100 text-gray-800">

    <!-- Main Application Container (Horizontal Flex) -->
    <div class="flex h-screen overflow-hidden">
        
        <!-- Sidebar Navigation -->
        <div id="sidebar" class="sidebar w-64 bg-mondelez-blue text-white p-4 flex flex-col justify-between">
            <div>
                <!-- Logo/Title and Collapse Button -->
                <div class="flex items-center justify-between mb-8">
                    <div id="sidebar-header" class="text-xl font-extrabold text-mondelez-yellow flex items-center overflow-hidden whitespace-nowrap">
                        <img src="https://placehold.co/40x40/ffd700/4f2170?text=M" alt="Logo" class="rounded mr-2">
                        <span id="logo-text" class="nav-text">Enquiry Hub</span>
                    </div>
                    <button id="sidebar-toggle" onclick="toggleSidebar()" class="text-white hover:text-mondelez-yellow p-1 transition-transform duration-300">
                        <i id="sidebar-toggle-icon" data-lucide="chevrons-left" class="w-6 h-6 transition-transform duration-300"></i>
                    </button>
                </div>

                <!-- Role Switcher -->
                 <div class="mb-4 p-2 bg-mondelez-blue/50 rounded-lg">
                    <div class="text-xs font-semibold text-mondelez-yellow mb-1">Current Role: <span id="user-role-display">Partner</span></div>
                    <button onclick="switchRole()" class="text-xs text-white/90 hover:underline flex items-center">
                        <i data-lucide="user-check" class="w-4 h-4 mr-1"></i> Switch to <span id="switch-role-label">SME</span> Mode
                    </button>
                </div>


                <!-- Vertical Navigation Bar (Role-Aware) -->
                <nav id="vertical-nav" class="space-y-2">
                    
                    <!-- 1. Dashboard (Central Hub) -->
                    <a href="#" data-page="dashboard" class="nav-link-item active-link" onclick="showPage('dashboard', this)">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>

                    <!-- 2. ENQUIRY MANAGEMENT (Dropdown) -->
                    <div class="relative">
                        <button id="enquiry-btn" onclick="toggleDropdown(event, this, 'enquiry-menu')" class="nav-link-item flex items-center w-full">
                            <i data-lucide="send" class="w-5 h-5 mr-3"></i>
                            <span class="nav-text flex justify-between items-center w-full">
                                Enquiry Management
                                <i data-lucide="chevron-down" class="w-4 h-4 ml-1 transition-transform duration-200"></i>
                            </span>
                        </button>
                        <div id="enquiry-menu" class="absolute hidden bg-mondelez-blue pt-1 pb-1 rounded-lg shadow-xl min-w-[200px] z-10 top-0 left-full border border-mondelez-blue/50">
                            <a href="#" data-page="new_enquiry" class="nav-link-sub" onclick="showPage('new_enquiry', this, true)">New Enquiry / Submission</a>
                            <a href="#" data-page="status_workflow" class="nav-link-sub" onclick="showPage('status_workflow', this, true)">Status & Workflow</a>
                            <a href="#" data-page="enquiry_examples" class="nav-link-sub" onclick="showPage('enquiry_examples', this, true)">Enquiry Matrix Examples</a>
                        </div>
                    </div>

                    <!-- 3. INFORMATION & GOVERNANCE (Dropdown) -->
                    <div class="relative">
                        <button id="gov-info-btn" onclick="toggleDropdown(event, this, 'gov-info-menu')" class="nav-link-item flex items-center w-full">
                            <i data-lucide="award" class="w-5 h-5 mr-3"></i>
                            <span class="nav-text flex justify-between items-center w-full">
                                Info & Governance
                                <i data-lucide="chevron-down" class="w-4 h-4 ml-1 transition-transform duration-200"></i>
                            </span>
                        </button>
                        <div id="gov-info-menu" class="absolute hidden bg-mondelez-blue pt-1 pb-1 rounded-lg shadow-xl min-w-[200px] z-10 top-0 left-full border border-mondelez-blue/50">
                            <a href="#" data-page="certificates" class="nav-link-sub" onclick="showPage('certificates', this, true)">Certificates & Documents</a>
                            <a href="#" data-page="sustainability" class="nav-link-sub" onclick="showPage('sustainability', this, true)">Sustainability & ESG Site</a>
                        </div>
                    </div>

                    <!-- 4. SUPPORT & REFERENCE (Dropdown) -->
                    <div class="relative">
                        <button id="support-ref-btn" onclick="toggleDropdown(event, this, 'support-ref-menu')" class="nav-link-item flex items-center w-full">
                            <i data-lucide="help-circle" class="w-5 h-5 mr-3"></i>
                            <span class="nav-text flex justify-between items-center w-full">
                                Support & Reference
                                <i data-lucide="chevron-down" class="w-4 h-4 ml-1 transition-transform duration-200"></i>
                            </span>
                        </button>
                        <div id="support-ref-menu" class="absolute hidden bg-mondelez-blue pt-1 pb-1 rounded-lg shadow-xl min-w-[200px] z-10 top-0 left-full border border-mondelez-blue/50">
                            <a href="#" data-page="raci" class="nav-link-sub" onclick="showPage('raci', this, true)">RACI & Process Ownership</a>
                            <a href="#" data-page="contacts" class="nav-link-sub" onclick="showPage('contacts', this, true)">Key Contacts & Links</a>
                            <a href="#" data-page="templates" class="nav-link-sub" onclick="showPage('templates', this, true)">Standard Response Templates</a>
                        </div>
                    </div>
                </nav>
            </div>
            
            <!-- AI Chatbot Toggle (Bottom of Sidebar) -->
            <button id="chatbot-button" class="bg-mondelez-yellow text-mondelez-blue font-bold py-3 px-4 rounded-lg shadow-lg hover:opacity-90 transition-colors flex items-center justify-center mt-6 w-full" onclick="toggleChatbot()">
                <i data-lucide="bot" class="w-5 h-5 mr-2"></i>
                <span class="nav-text">AI Assistant</span>
            </button>
        </div>

        <!-- Main Content Area -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-white">
            <!-- Fixed Header -->
            <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 shadow-sm sticky top-0 z-10">
                <h1 id="page-title" class="text-2xl font-semibold text-mondelez-blue">Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500">Logged in as: <span id="header-user-role">Partner</span></span>
                    <i data-lucide="user" class="w-6 h-6 text-mondelez-blue"></i>
                </div>
            </header>

            <!-- Page Content Views -->
            <div id="content-container" class="p-6 page-content">
                <!-- Content will be injected here -->
            </div>
        </main>

        <!-- AI Chatbot Overlay (Full-Page Modal) -->
        <div id="chatbot-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-30 flex items-center justify-center" onclick="toggleChatbot()">
            <div class="bg-white rounded-xl shadow-2xl flex flex-col w-[95%] max-w-4xl h-[95vh]" onclick="event.stopPropagation()">
                <div class="bg-mondelez-blue text-white p-4 flex justify-between items-center rounded-t-xl">
                    <div class="flex items-center">
                        <i data-lucide="bot" class="w-6 h-6 mr-2 text-mondelez-yellow"></i>
                        <h2 class="text-xl font-bold">Mondelez AI Assistant / Enquiry Submission</h2>
                    </div>
                    <button class="text-white hover:text-mondelez-yellow p-1" onclick="toggleChatbot()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <div class="chat-container">
                    <!-- Messages Area -->
                    <div id="chat-messages" class="chat-messages p-4 bg-gray-50">
                        <div class="p-3 bg-mondelez-blue text-white rounded-lg mb-2 max-w-xs self-start">
                            Hello! I'm your Mondelez AI Assistant. You can submit your enquiry directly here or ask general questions. How can I help today?
                        </div>
                    </div>

                    <!-- Input Area -->
                    <div class="p-4 border-t border-gray-200 bg-white">
                        <div id="loading-indicator" class="text-mondelez-blue text-sm mb-2 hidden">
                            <span class="animate-pulse">Assistant is thinking...</span>
                        </div>
                        <div class="flex">
                            <input type="text" id="chat-input" class="flex-1 p-3 border border-gray-300 rounded-l-lg focus:ring-mondelez-yellow focus:border-mondelez-yellow" placeholder="Type your enquiry, e.g., 'FSSC certificate for product XYZ'..." onkeydown="if(event.key === 'Enter') sendMessage()">
                            <button id="send-button" class="bg-mondelez-blue text-white p-3 rounded-r-lg hover:bg-mondelez-blue/90 disabled:opacity-50 transition-colors" onclick="sendMessage()">
                                Send
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        const contentContainer = document.getElementById('content-container');
        const pageTitle = document.getElementById('page-title');
        const chatbotOverlay = document.getElementById('chatbot-overlay');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const loadingIndicator = document.getElementById('loading-indicator');
        const sendButton = document.getElementById('send-button');
        
        // Sidebar elements for collapse logic
        const sidebar = document.getElementById('sidebar');
        const logoText = document.getElementById('logo-text');
        const sidebarToggleIcon = document.getElementById('sidebar-toggle-icon');
        const navTexts = document.querySelectorAll('.nav-text');
        const chatbotButton = document.getElementById('chatbot-button');
        
        let currentRole = 'Partner'; // Default Role

        // --- Role Switching Logic ---
        function updateRoleDisplay() {
            const roleDisplay = document.getElementById('user-role-display');
            const headerRoleDisplay = document.getElementById('header-user-role');
            const switchRoleLabel = document.getElementById('switch-role-label');

            if (roleDisplay) roleDisplay.textContent = currentRole;
            if (headerRoleDisplay) headerRoleDisplay.textContent = currentRole;
            if (switchRoleLabel) switchRoleLabel.textContent = currentRole === 'Partner' ? 'SME' : 'Partner';

            // Re-render the dashboard to show role-specific content
            showPage('dashboard', document.querySelector('.nav-link-item[data-page="dashboard"]'));
        }

        function switchRole() {
            currentRole = currentRole === 'Partner' ? 'SME' : 'Partner';
            updateRoleDisplay();
        }


        // --- Simulated API Configuration ---
        const API_MODEL = 'gemini-2.5-flash-preview-09-2025';
        const apiKey = ""; // Canvas environment will provide the key
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${apiKey}`;
        const SYSTEM_PROMPT = "You are a friendly, knowledgeable assistant for the Mondelez International Partner Portal. Provide concise, professional, and helpful answers based on the company's initiatives and products. If you use external information, ensure you cite the sources.";
        // --- END API Configuration ---
        
        /**
         * Toggles the collapse state of the sidebar.
         */
        function toggleSidebar() {
            const isExpanded = sidebar.classList.contains('w-64');
            const navItems = document.querySelectorAll('.nav-link-item');
            
            // 1. Toggle Sidebar Width
            sidebar.classList.toggle('w-64');
            sidebar.classList.toggle('w-20');
            
            // 2. Toggle Header/Logo visibility and padding
            logoText.classList.toggle('hidden');
            
            // 3. Toggle Navigation Text visibility and icon alignment
            navTexts.forEach(span => {
                 // Check if the span is the toggle button's text, only hide/show the general text
                if (span.closest('#chatbot-button')) return;
                span.classList.toggle('hidden');
            });
            
            navItems.forEach(link => {
                const icon = link.querySelector('i:not(.transition-transform)'); // Select main icon, excluding chevron
                if (icon) {
                    if (isExpanded) {
                        icon.classList.remove('mr-3');
                        icon.classList.add('mx-auto');
                    } else {
                        icon.classList.add('mr-3');
                        icon.classList.remove('mx-auto');
                    }
                }
            });

            // 4. Toggle Chatbot Button content/styling
            const chatbotText = chatbotButton.querySelector('.nav-text');
            const chatbotIcon = chatbotButton.querySelector('i');
            
            if (isExpanded) {
                // Collapse state: hide text, center icon, make button square
                if (chatbotText) chatbotText.classList.add('hidden');
                if (chatbotIcon) chatbotIcon.classList.remove('mr-2');
                chatbotButton.classList.remove('w-full', 'px-4');
                chatbotButton.classList.add('w-12', 'h-12', 'p-1', 'mx-auto');
            } else {
                // Expand state: show text, add margin back, make button wide
                if (chatbotText) chatbotText.classList.remove('hidden');
                if (chatbotIcon) chatbotIcon.classList.add('mr-2');
                chatbotButton.classList.add('w-full', 'px-4');
                chatbotButton.classList.remove('w-12', 'h-12', 'p-1', 'mx-auto');
            }


            // 5. Rotate Toggle Icon
            sidebarToggleIcon.classList.toggle('rotate-180');
            
            // 6. Close any open dropdown menus (as they behave awkwardly when sidebar resizes)
            document.querySelectorAll('#vertical-nav .relative > div').forEach(menu => {
                menu.classList.add('hidden');
                const chevron = menu.previousElementSibling.querySelector('.nav-text i');
                if (chevron) chevron.classList.remove('rotate-180');
            });
        }


        /**
         * Toggles the visibility of a dropdown menu, handles safe closure, and positions it correctly for the vertical sidebar.
         * @param {Event} event - The click event.
         * @param {HTMLElement} parentButton - The button element that was clicked.
         * @param {string} menuId - The ID of the dropdown menu div.
         */
        function toggleDropdown(event, parentButton, menuId) {
            event.stopPropagation();
            const targetMenu = document.getElementById(menuId);
            
            if (!targetMenu || !parentButton) {
                console.error(`Missing menu elements for ID ${menuId}.`);
                return;
            }

            const chevron = parentButton.querySelector('.nav-text i');

            // Close all other dropdowns safely
            document.querySelectorAll('#vertical-nav .relative').forEach(container => {
                const menu = container.querySelector('div[id$="-menu"]');
                const iterationChevron = container.querySelector('.nav-text i');

                if (menu && menu.id !== menuId) {
                    menu.classList.add('hidden');
                    if (iterationChevron) iterationChevron.classList.remove('rotate-180');
                }
            });

            // Toggle target menu visibility and rotate its chevron safely
            targetMenu.classList.toggle('hidden');
            if (chevron) {
                 chevron.classList.toggle('rotate-180');
            }
        }

        /**
         * Closes all dropdowns when clicking outside.
         */
        document.addEventListener('click', function(event) {
            const isClickInsideNav = document.getElementById('sidebar').contains(event.target);
            if (!isClickInsideNav) {
                // Close all dropdowns safely
                document.querySelectorAll('#vertical-nav .relative').forEach(container => {
                    const menu = container.querySelector('div[id$="-menu"]');
                    const chevron = container.querySelector('.nav-text i');
                    
                    if (menu) {
                        menu.classList.add('hidden');
                        if (chevron) chevron.classList.remove('rotate-180');
                    }
                });
            }
        });
        

        /**
         * Simulates an API call with exponential backoff.
         * ... (API functions omitted for brevity, logic remains the same)
         */
        async function fetchWithBackoff(payload, retries = 0) {
            const MAX_RETRIES = 5;
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.status === 429 && retries < MAX_RETRIES) {
                    const delay = Math.pow(2, retries) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchWithBackoff(payload, retries + 1);
                }

                if (!response.ok) {
                    throw new Error(`API error: ${response.statusText}`);
                }

                return response.json();

            } catch (error) {
                console.error("API Call failed after retries:", error);
                throw new Error("Could not connect to the AI service. Please try again later.");
            }
        }

        async function sendMessage() {
            const userQuery = chatInput.value.trim();
            if (!userQuery) return;
            addMessage(userQuery, 'user');
            chatInput.value = '';
            
            sendButton.disabled = true;
            chatInput.disabled = true;
            loadingIndicator.classList.remove('hidden');

            try {
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: { parts: [{ text: SYSTEM_PROMPT }] },
                };
                const result = await fetchWithBackoff(payload);
                const candidate = result.candidates?.[0];
                let responseText = "Sorry, I couldn't generate a response. Please try rephrasing your question.";
                let sources = [];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    responseText = candidate.content.parts[0].text;
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({ uri: attribution.web?.uri, title: attribution.web?.title }))
                            .filter(source => source.uri && source.title);
                    }
                }
                addMessage(responseText, 'assistant', sources);
            } catch (error) {
                console.error("Chatbot Error:", error);
                addMessage("An unexpected error occurred: " + error.message, 'assistant');
            } finally {
                sendButton.disabled = false;
                chatInput.disabled = false;
                loadingIndicator.classList.add('hidden');
                chatInput.focus();
            }
        }
        
        function addMessage(text, sender, sources = []) {
            const messageDiv = document.createElement('div');
            
            if (sender === 'user') {
                messageDiv.className = 'p-3 bg-mondelez-yellow text-mondelez-blue rounded-lg mb-4 max-w-xs self-end ml-auto shadow-md';
            } else { // assistant
                messageDiv.className = 'p-3 bg-mondelez-blue text-white rounded-lg mb-4 max-w-xs self-start shadow-md';
            }

            let formattedText = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" class="underline hover:text-mondelez-yellow">$1</a>');
            
            formattedText = formattedText.split('\n').map(line => {
                if (line.trim().startsWith('* ') || line.trim().startsWith('- ')) {
                    return `<li>${line.substring(2).trim()}</li>`;
                }
                return line;
            }).join('<br>');
            
            messageDiv.innerHTML = formattedText;

            if (sources.length > 0) {
                const sourceList = document.createElement('div');
                sourceList.className = 'mt-2 pt-2 border-t border-mondelez-yellow text-xs text-yellow-200';
                sourceList.innerHTML = '<strong>Sources:</strong><ul>' + 
                    sources.map((src, index) => `<li><a href="${src.uri}" target="_blank" class="hover:underline">${src.title}</a></li>`).join('') + 
                    '</ul>';
                messageDiv.appendChild(sourceList);
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function toggleChatbot() {
            const isOpen = chatbotOverlay.classList.contains('hidden');
            if (isOpen) {
                chatbotOverlay.classList.remove('hidden');
                chatInput.focus();
            } else {
                chatbotOverlay.classList.add('hidden');
            }
        }

        /**
         * Manages the content view and navigation state.
         * @param {string} pageKey - The key corresponding to the page content function.
         * @param {HTMLElement} navItem - The clicked navigation element (<a> or <button>).
         * @param {boolean} isSubLink - True if the item is a sub-link.
         */
        function showPage(pageKey, navItem, isSubLink = false) {
            
            // 1. Clear Active State on ALL links and sub-links
            document.querySelectorAll('.nav-link-item').forEach(link => {
                link.classList.remove('active-link');
            });
            document.querySelectorAll('.nav-link-sub').forEach(link => {
                link.classList.remove('active-link-sub');
            });

            // 2. Set Active State on the clicked item
            if (navItem) {
                if (isSubLink) {
                    navItem.classList.add('active-link-sub');
                    // Find and activate the parent top-level button link
                    const topButton = navItem.closest('.relative').querySelector('.nav-link-item');
                    if (topButton) {
                        topButton.classList.add('active-link');
                    }
                } else {
                    // For the single Dashboard link, just activate it directly
                    navItem.classList.add('active-link');
                }
            }
            
            // 3. Close all dropdowns after selection
            document.querySelectorAll('#vertical-nav .relative').forEach(container => {
                const menu = container.querySelector('div[id$="-menu"]');
                const chevron = container.querySelector('.nav-text i');
                
                if (menu) {
                    menu.classList.add('hidden');
                    if (chevron) chevron.classList.remove('rotate-180');
                }
            });

            // 4. Update content
            const pageConfig = pageContent[pageKey];
            if (pageConfig) {
                pageTitle.textContent = pageConfig.title;
                contentContainer.innerHTML = pageConfig.html;
            } else {
                pageTitle.textContent = "Page Not Found";
                contentContainer.innerHTML = `<div class="p-8 text-center text-gray-500">The requested page does not exist.</div>`;
            }
        }

        // --- Page Content Definitions ---
        const pageContent = {
            'dashboard': {
                title: 'Partner Dashboard',
                html: `
                    <div class="space-y-6">
                        <div id="role-dashboard-content"></div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Metric Card 1: Open Enquiries (Dynamic) -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-mondelez-blue">
                                <h3 class="text-lg font-semibold text-gray-600">Open Enquiries</h3>
                                <p class="text-4xl font-bold text-mondelez-blue mt-2">12</p>
                                <p class="text-sm text-gray-500 mt-1">Awaiting Resolution</p>
                            </div>
                            <!-- Metric Card 2: Compliance Rate -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-mondelez-yellow">
                                <h3 class="text-lg font-semibold text-gray-600">Latest Document Compliance</h3>
                                <p class="text-4xl font-bold text-mondelez-blue mt-2">98.5%</p>
                                <p class="text-sm text-gray-500 mt-1">Last Audit Score</p>
                            </div>
                            <!-- Metric Card 3: Pending Approvals (SME only) -->
                            <div id="pending-approvals-card" class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-mondelez-blue">
                                <h3 class="text-lg font-semibold text-gray-600">Pending Actions</h3>
                                <p class="text-4xl font-bold text-mondelez-blue mt-2">4</p>
                                <p class="text-sm text-gray-500 mt-1">Assigned to my role</p>
                            </div>
                        </div>
                    </div>
                `
            },
            'new_enquiry': {
                title: 'New Enquiry / Submission',
                html: `
                    <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold text-mondelez-blue mb-6">Enquiry Submission Form</h2>
                        <p class="text-gray-600 mb-4">Please provide details of your request. Submitting complete, mandatory data reduces rework (Partner Pain Point).</p>

                        <form class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Requester Type</label>
                                <select class="w-full p-3 border border-gray-300 rounded-lg focus:ring-mondelez-yellow focus:border-mondelez-yellow">
                                    <option>Customer-facing function</option>
                                    <option>Direct Customer</option>
                                    <option>Internal Mondelez User</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Primary Type of Request (e.g., FSSC Certificate)</label>
                                <input type="text" placeholder="e.g. FSSC Certificate" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-mondelez-yellow focus:border-mondelez-yellow">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Mandatory: Product Details (SKU, GTIN, Batch Codes, Customer)</label>
                                <textarea rows="4" placeholder="Please list the affected SKUs, GTINs, Batch Codes, and the Customer Country." class="w-full p-3 border border-gray-300 rounded-lg focus:ring-mondelez-yellow focus:border-mondelez-yellow"></textarea>
                            </div>
                            <button type="submit" class="bg-mondelez-blue text-white px-6 py-3 rounded-lg hover:bg-mondelez-blue/90 font-bold">
                                Submit Enquiry
                            </button>
                        </form>
                        <p class="text-sm text-gray-500 mt-4">Note: The system will automatically classify this as Basic, Intermediate, or Advanced and route to the Responsible SME (RACI).</p>
                    </div>
                `
            },
            'status_workflow': {
                title: 'Enquiry Status & Workflow',
                html: `
                    <div class="space-y-6">
                        <p class="text-lg text-gray-600">Track the current status and approval path for all submitted enquiries (High priority for Partner/SME).</p>
                        
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold text-mondelez-blue mb-4">Enquiry Queue (Showing role-specific view)</h3>
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Request Summary</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Classification</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Current Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Actioner / Approver</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">MDLZ-001</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Vegan certificate needed (SKU 12345)</td>
                                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Intermediate</span></td>
                                        <td class="px-6 py-4 whitespace-nowrap">Awaiting SME Response (SARA)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">SARA (Responsible)</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">MDLZ-002</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Query on Acrylamide levels</td>
                                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">Advanced</span></td>
                                        <td class="px-6 py-4 whitespace-nowrap">Awaiting Legal (Approver) Sign-off</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Food Safety / CGA (Approver)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="bg-gray-50 p-6 rounded-xl shadow-inner">
                            <h3 class="text-xl font-semibold text-mondelez-blue mb-3">Enquiry Workflow Summary (from Enquiry Workflow CSV)</h3>
                            <ul class="list-disc list-inside space-y-1 text-gray-700 text-sm">
                                <li>**Initiation:** Enquiry entered into form/chatbox with mandatory data (Partner Action).</li>
                                <li>**Basic Workflow:** System attempts automated response (Retrieves document/statement).</li>
                                <li>**Intermediate/Advanced:** Routed to Responsible SME (RACI 'R').</li>
                                <li>**Advanced:** Response may require **Approver Sign-off** (CGA, Legal) before issue.</li>
                                <li>**Closure:** System issues response to the Customer; Key Contacts are informed.</li>
                            </ul>
                        </div>
                    </div>
                `
            },
            'enquiry_examples': {
                title: 'Enquiry Matrix Examples',
                html: `
                    <div class="space-y-6">
                        <p class="text-lg text-gray-600">Examples of common partner enquiries, showing the classification and mandatory data required (Addresses Partner Pain Point: Uncertainty about mandatory data).</p>
                        
                        <div class="overflow-x-auto bg-white p-6 rounded-xl shadow-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-mondelez-blue text-white">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Enquiry Topic</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Type (Primary)</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Mandatory Data</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Classification</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">RACI Responsible</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">FSSC Certificate(s) requested</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Certificate - food safety, quality</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Customer Country, Product(s)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Basic</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Automated / Workflow</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">Vegan Claim / Suitability</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Product or ingredients claims</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Product data (or Company statement)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Intermediate</td>
                                        <td class="px-6 py-4 whitespace-nowrap">SARA</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">Acrylamide levels query</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Chemicals and contaminants</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Product data (or Company statement)</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Advanced</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Food Safety</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `
            },
            'certificates': {
                title: 'Certificates & Standard Response Documents',
                html: `
                    <div class="space-y-6">
                        <p class="text-lg text-gray-600">Access generic, pre-approved documents (Certificates) and standard response templates (Addresses Partner Pain Point: Lack of standardized responses).</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Section 1: Standard Certificates (Direct Download) -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-mondelez-blue">
                                <h3 class="text-xl font-semibold text-mondelez-blue mb-4">Quality & Compliance Certificates</h3>
                                <ul class="space-y-4">
                                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="font-medium">ISO 9001:2015 Quality Management (2024)</span>
                                        <button class="text-mondelez-blue hover:text-mondelez-blue/90 flex items-center text-sm">
                                            <i data-lucide="download" class="w-4 h-4 mr-1"></i> Download
                                        </button>
                                    </li>
                                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="font-medium">HACCP Food Safety Certificate (Global)</span>
                                        <button class="text-mondelez-blue hover:text-mondelez-blue/90 flex items-center text-sm">
                                            <i data-lucide="download" class="w-4 h-4 mr-1"></i> Download
                                        </button>
                                    </li>
                                </ul>
                            </div>
                            <!-- Section 2: Standard Responses (View/Copy) -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-mondelez-yellow">
                                <h3 class="text-xl font-semibold text-mondelez-blue mb-4">Standard Response Templates (SME Priority: High)</h3>
                                <ul class="space-y-4">
                                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="font-medium">Certificate of Conformity (Template)</span>
                                        <button class="text-mondelez-blue hover:text-mondelez-blue/90 flex items-center text-sm">
                                            <i data-lucide="file-text" class="w-4 h-4 mr-1"></i> View/Copy
                                        </button>
                                    </li>
                                    <li class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                        <span class="font-medium">Quality & Health Certificate (Template)</span>
                                        <button class="text-mondelez-blue hover:text-mondelez-blue/90 flex items-center text-sm">
                                            <i data-lucide="file-text" class="w-4 h-4 mr-1"></i> View/Copy
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `
            },
            'sustainability': {
                title: 'Sustainability & ESG Site',
                html: `
                    <div class="space-y-6">
                        <p class="text-lg text-gray-600">Access official Mondelez documentation on ESG, sustainable sourcing, and our 'Snacking Made Right' commitments (from Important Links).</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Cocoa Life Card -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-600">
                                <h3 class="text-xl font-semibold text-green-700 mb-2">Cocoa Life Program</h3>
                                <p class="text-gray-700 mb-3">Sustainable and ethical cocoa sourcing, empowering farming communities.</p>
                                <a href="https://www.cocoalife.org/" target="_blank" class="text-mondelez-blue hover:underline text-sm font-medium">Go to Cocoa Life Site</a>
                            </div>
                            <!-- ESG Reporting Card -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-mondelez-blue">
                                <h3 class="text-xl font-semibold text-mondelez-blue mb-2">ESG Reporting & Disclosure</h3>
                                <p class="text-gray-700 mb-3">Access the latest reports detailing progress on climate action and social sustainability.</p>
                                <a href="https://www.mondelezinternational.com/snacking-made-right/reporting-and-disclosure/" target="_blank" class="text-mondelez-blue hover:underline text-sm font-medium">View Reports</a>
                            </div>
                        </div>
                    </div>
                `
            },
            'raci': {
                title: 'RACI & Process Ownership',
                html: `
                    <div class="space-y-6">
                        <p class="text-lg text-gray-600">Reference the Responsible, Accountable, Consulted, and Informed (RACI) matrix for key cross-functional processes (High priority for SME/Actioners).</p>
                        
                        <div class="overflow-x-auto bg-white p-6 rounded-xl shadow-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-mondelez-blue text-white">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Primary Topic</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Category</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">R: Responsible Function (SME)</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">A: Accountable</th>
                                        <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider">Approval Required?</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">Acrylamide levels</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Chemicals and contaminants</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Food Safety</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Direct Customer Contact</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Yes (CGA/Legal)</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">Vegan claim</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Product claims</td>
                                        <td class="px-6 py-4 whitespace-nowrap">SARA</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Direct Customer Contact</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Yes (SARA)</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">Veterinary certificate</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Import / Export</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Export team</td>
                                        <td class="px-6 py-4 whitespace-nowrap">Export team for location</td>
                                        <td class="px-6 py-4 whitespace-nowrap">No (R is final)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                `
            },
            'contacts': {
                title: 'Key Contacts & Important Links',
                html: `
                    <div class="space-y-6">
                        <p class="text-lg text-gray-600">Quickly find the right department contact or important external reference links (High priority for SME/Actioners).</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Contact Section -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-mondelez-blue">
                                <h4 class="text-xl font-bold text-mondelez-blue mb-3">Key Contact Information (SMEs/Approvers)</h4>
                                <ul class="space-y-2 text-gray-700">
                                    <li class="border-b pb-2"><strong>General UK&I:</strong> Quality.UKI@mdlz.com (Example SME Contact)</li>
                                    <li class="border-b pb-2"><strong>Global Regulatory (CGA):</strong> Approver for complex legal/governance.</li>
                                    <li class="border-b pb-2"><strong>Harmony Team (EU):</strong> S.Belal (Consulted/Informed).</li>
                                    <li class="text-sm text-gray-500 pt-2">Use this to contact other R/A/C/I parties (SME Pain Point).</li>
                                </ul>
                            </div>
                            <!-- Links Section -->
                            <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-mondelez-yellow">
                                <h4 class="text-xl font-bold text-mondelez-blue mb-3">Important External Links (from Important Links CSV)</h4>
                                <ul class="space-y-2">
                                    <li><a href="https://digitalcatalog-public.1worldsync.com/dc-ui/public/#/p/Mondelez" target="_blank" class="text-mondelez-blue hover:underline">Digital Catalog - Product Reports</a></li>
                                    <li><a href="https://collaboration.mdlz.com/sites/retailer_engagement_platform/Pages/Home.aspx" target="_blank" class="text-mondelez-blue hover:underline">Retailer Engagement Platform</a></li>
                                    <li><a href="https://www.cocoalife.org/" target="_blank" class="text-mondelez-blue hover:underline">Cocoa Life Program Site</a></li>
                                    <li><a href="QIT tool" target="_blank" class="text-mondelez-blue hover:underline">Link to QIT (for customer complaints)</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `
            },
            'templates': {
                title: 'Standard Response Templates',
                html: `
                    <div class="space-y-6">
                        <p class="text-lg text-gray-600">Templates for quick and consistent communication (Addresses SME Pain Point: Time spent compiling responses).</p>
                        
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-semibold text-mondelez-blue mb-4">Template Library (Examples)</h3>
                            
                            <details class="group border-b border-gray-200 py-3">
                                <summary class="flex justify-between items-center cursor-pointer font-medium text-lg text-mondelez-blue hover:text-mondelez-blue/90">
                                    Certificate of Conformity (Template)
                                    <span class="transform transition-transform duration-200 group-open:rotate-180">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </span>
                                </summary>
                                <div class="mt-2 text-gray-700 p-2 bg-gray-50 rounded-md text-sm">
                                    <p>Template content for Certificate of Conformity...</p>
                                    <button class="mt-3 text-xs text-mondelez-yellow bg-mondelez-blue px-3 py-1 rounded-full" onclick="document.execCommand('copy')">Copy Template</button>
                                </div>
                            </details>

                            <details class="group border-b border-gray-200 py-3">
                                <summary class="flex justify-between items-center cursor-pointer font-medium text-lg text-mondelez-blue hover:text-mondelez-blue/90">
                                    Quality & Health Certificate (Template)
                                    <span class="transform transition-transform duration-200 group-open:rotate-180">
                                        <i data-lucide="chevron-down" class="w-5 h-5"></i>
                                    </span>
                                </summary>
                                <div class="mt-2 text-gray-700 p-2 bg-gray-50 rounded-md text-sm">
                                    <p>Template content for Quality & Health Certificate...</p>
                                    <button class="mt-3 text-xs text-mondelez-yellow bg-mondelez-blue px-3 py-1 rounded-full" onclick="document.execCommand('copy')">Copy Template</button>
                                </div>
                            </details>
                        </div>
                    </div>
                `
            },
        };
        
        /**
         * Renders content specific to the current role on the Dashboard page.
         */
        function renderDashboardContent() {
            const container = document.getElementById('role-dashboard-content');
            if (!container) return;

            let html = '';
            let cardVisibility = 'block';

            if (currentRole === 'Partner') {
                html = `
                    <div class="bg-mondelez-yellow text-mondelez-blue p-6 rounded-xl shadow-lg flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold">Welcome, Partner! Submit & Track Your Enquiries.</h2>
                            <p class="mt-1 text-sm">Use the form below or the AI Assistant to log a request. Check "Enquiry Matrix Examples" to ensure you provide mandatory data (SKU, GTIN, Customer Country).</p>
                        </div>
                        <button class="bg-mondelez-blue text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-mondelez-blue/90 transition-colors flex items-center flex-shrink-0" onclick="showPage('new_enquiry', document.getElementById('enquiry-btn'))">
                            <i data-lucide="send" class="w-5 h-5 mr-2"></i> Submit New Enquiry
                        </button>
                    </div>
                `;
                // Partners see all cards
                cardVisibility = 'block';
            } else { // SME Mode
                html = `
                    <div class="bg-mondelez-blue/90 text-white p-6 rounded-xl shadow-lg border-l-4 border-mondelez-yellow">
                        <h2 class="text-2xl font-bold">SME Dashboard: Actions & Approvals</h2>
                        <p class="mt-1 text-sm text-mondelez-yellow">Your view is prioritized for *Actioning* assigned tasks and *Approving* complex responses.</p>
                        <div class="mt-4 flex space-x-4">
                            <button class="bg-mondelez-yellow text-mondelez-blue font-bold py-2 px-4 rounded-lg hover:opacity-90 transition-colors" onclick="showPage('status_workflow', document.getElementById('enquiry-btn'))">
                                Review Assigned Enquiries
                            </button>
                             <button class="bg-white text-mondelez-blue border border-mondelez-blue font-bold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors" onclick="showPage('raci', document.getElementById('support-ref-btn'))">
                                View RACI Matrix
                            </button>
                        </div>
                    </div>
                `;
                // SMEs need the pending approvals card, but maybe not the others
                cardVisibility = 'block';
            }
            
            container.innerHTML = html;
            const approvalsCard = document.getElementById('pending-approvals-card');
            if (approvalsCard) {
                // Example of toggling a specific card based on role
                // approvalsCard.style.display = currentRole === 'SME' ? 'block' : 'none';
            }
            
            // Re-render Lucide icons injected by JS
            if (typeof createIcons !== 'undefined') {
                createIcons({ icons: { Send, UserCheck, LayoutDashboard, Briefcase, Users, BookOpen, Award, Globe, ClipboardList, Phone, FileText, Bot, ChevronsLeft, GraduationCap, Calendar, MessageSquare, Download, ChevronDown, User, Send, ListOrdered, FileSearch, HelpCircle } });
            }
        }
        

        // --- Initialization ---
        window.onload = () => {
            updateRoleDisplay(); // Set initial role display
            // Set initial page
            const initialPage = document.querySelector('.nav-link-item[data-page="dashboard"]');
            showPage('dashboard', initialPage);
        };
    </script>
</body>
</html>
